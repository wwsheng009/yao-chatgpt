/* empty css             */import{_ as w,r as p,w as C,v as A,o as l,c,a,b as r,d as k,F as B,e as L,f as N,g as y,t as x,h as T,i as j}from"./index-63368c72.js";function z({url:e,data:t,headers:d,onDownloadProgress:n}){return new Promise((o,v)=>{fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Accept:"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive",...d},body:JSON.stringify({stream:!0,...t})}).then(h=>{var f;const m=(f=h.body)==null?void 0:f.getReader();function _(){m&&m.read().then(({value:s,done:D})=>{const I=new TextDecoder().decode(s);if(D)console.log("done"),o({data:{data:""},message:"",status:200});else{const b=I.split(`

`);for(const S in b){const g=b[S];if(g.startsWith(`event:session_id
data:`)){let u=g.substring(22);n==null||n({sesseion_id:u})}else{if(!g.includes("event:messages"))continue;let u=g.replace(/event:messages\n/g,"");u=u.replace(/data:/g,""),n==null||n({message:u})}}return _()}}).catch(s=>{v(s)})}return _()}).catch(h=>{v(h)})})}const E={components:{},data(){return{isDarkTheme:!1,contentDiv:[],textarea:"",right:!0,show:!1,flag:!0,closeChat:this.close,sessionId:"",template:[],template_id:""}},async created(){let e=localStorage.getItem("dark_theme");this.isDarkTheme=e=="dark";let t=localStorage.getItem("session_id");if(t){this.sessionId=t;let n=localStorage.getItem(this.sessionId);n&&(this.contentDiv=JSON.parse(n))}this.scrollToBottom();const d=await fetch("/api/ai/templates",{method:"GET",headers:{"Content-Type":"application/json"}});this.template=await d.json(),this.template_id=this.template[0].value},watch:{isDarkTheme:{handler(e,t){t!=null&&(localStorage.setItem("dark_theme",this.isDarkTheme?"dark":"light"),this.isDarkTheme?(document.body.classList.remove("light-theme"),document.body.classList.add("dark-theme")):(document.body.classList.remove("dark-theme"),document.body.classList.add("light-theme")))},deep:!0,immediate:!0}},async mounted(){},updated(){this.scrollToBottom()},methods:{async fetchTemplate(){console.log(this.template_id);const e=await fetch(`/api/ai/template/${this.template_id}`,{method:"GET",headers:{"Content-Type":"application/json"}});this.textarea=await e.json()},scrollToBottom(){this.$nextTick(()=>{let e=this.$el.querySelector(".talk-content");e.scrollTop=e.scrollHeight})},clear(){this.sessionId&&(localStorage.removeItem(this.sessionId),localStorage.removeItem("session_id")),this.contentDiv=[],this.sessionId=""},async submit(){let e=this.textarea;if(e.trim().length==0)return;this.textarea="";let t=!1;this.contentDiv.length==0&&(t=!0);let d={name:"你",url:"",showAvartar:t,content:e,right:!0,time:new Date().toLocaleTimeString()};this.contentDiv.push(d),this.save();let i={name:"AI",url:"",showAvartar:t,content:"",right:!1,time:new Date().toLocaleTimeString()};this.contentDiv.push(i);let o={prompt:e,session_id:this.sessionId};await z({url:"/api/ai/ask-stream",data:o,onDownloadProgress:this.callback}),this.save()},save(){this.sessionId&&localStorage.setItem(this.sessionId,JSON.stringify(this.contentDiv))},callback(e){if(e.sesseion_id)this.sessionId=e.sesseion_id;else if(e.message){let t=this.contentDiv[this.contentDiv.length-1].content;this.contentDiv[this.contentDiv.length-1].content=t+e.message}},saveSession(e){localStorage.setItem("session_id",e)},exit(){this.$emit("close",this.flag)}}},F={class:"talk"},V={class:"talk-header"},O=a("div",{class:"talk-message-title"},"AI对话",-1),J={class:"talk-message-clear"},U={class:"talk-content"},G={key:0},K={key:0,style:{display:"flex","justify-content":"flex-end","align-items":"center"}},q={class:"name_right"},H={style:{"font-size":"0.5rem",color:"#9b9b9b"}},M={class:"url_right"},R={class:"content_right"},W={class:"content"},Q={key:1},X={key:0,style:{display:"flex","align-items":"center"}},Y={class:"url_left"},Z={class:"name_left"},$={style:{"font-size":"0.5rem",color:"#9b9b9b"}},P={class:"content_left"},ee={class:"content"},te={class:"talk-message"},se={class:"talk-message-content"},ae={class:"talk-message-send"};function ie(e,t,d,n,i,o){const v=p("a-select"),h=p("a-switch"),m=p("a-button"),_=p("a-avatar"),f=p("a-textarea");return C((l(),c("div",F,[a("div",V,[O,r(v,{class:"talk-role",dropdownClassName:"talk-role",value:i.template_id,"onUpdate:value":t[0]||(t[0]=s=>i.template_id=s),options:i.template,onChange:o.fetchTemplate},null,8,["value","options","onChange"]),a("div",J,[r(h,{"checked-children":"暗","un-checked-children":"亮",checked:i.isDarkTheme,"onUpdate:checked":t[1]||(t[1]=s=>i.isDarkTheme=s)},null,8,["checked"]),r(m,{type:"text",onClick:o.clear},{default:k(()=>[y("新会话")]),_:1},8,["onClick"])])]),a("div",U,[(l(!0),c(B,null,L(i.contentDiv,s=>(l(),c("div",null,[s.right?(l(),c("div",G,[s.showAvartar?(l(),c("div",K,[a("div",q,[a("p",H,x(s.time),1)]),a("div",M,[r(_,{shape:"circle",size:30},{default:k(()=>[y("你")]),_:1})])])):T("",!0),a("div",R,[a("pre",W,x(s.content),1)])])):T("",!0),s.right?T("",!0):(l(),c("div",Q,[s.showAvartar?(l(),c("div",X,[a("div",Y,[r(_,{shape:"circle",size:30,style:{backgroundColor:"#f56a00",verticalAlign:"middle"}},{default:k(()=>[y("AI")]),_:1})]),a("div",Z,[a("p",$,x(s.time),1)])])):T("",!0),a("div",P,[a("pre",ee,x(s.content),1)])]))]))),256))]),a("div",te,[a("div",se,[r(f,{class:"input-area",ref:"textarea",id:"textinput",value:i.textarea,"onUpdate:value":t[2]||(t[2]=s=>i.textarea=s),autoSize:"",rows:1,onKeydown:t[3]||(t[3]=N(j(s=>o.submit(),["exact","prevent"]),["enter"]))},null,8,["value"])]),a("div",ae,[r(m,{type:"text",onClick:o.submit},{default:k(()=>[y("发送")]),_:1},8,["onClick"])])])],512)),[[A,i.flag]])}const le=w(E,[["render",ie]]);export{le as default};
